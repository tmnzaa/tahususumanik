<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Kasir Assa Food</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { padding-bottom: 80px; }
    .active-tab { color: #dc2626; font-weight: bold; }
    .hidden-tab { display: none; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">

  <!-- Navbar Bawah -->
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around items-center py-2 shadow z-50 text-sm">
    <button onclick="showTab('home')" id="tab-home" class="flex flex-col items-center active-tab">
      🏠<span>Home</span>
    </button>
    <button onclick="showTab('rekap')" id="tab-rekap" class="flex flex-col items-center">
      📊<span>Rekap</span>
    </button>
  </nav>

  <!-- HOME -->
  <section id="home-tab" class="p-4">
    <h1 class="text-2xl font-bold mb-4 text-red-600">Pilih Produk</h1>
    <div class="grid grid-cols-2 gap-3 mb-4">
      <div onclick="addToCart('Tahu Susu Coba Coba',8000)" class="bg-white p-3 rounded shadow hover:bg-red-100 cursor-pointer">Tahu Coba - 8K</div>
      <div onclick="addToCart('Tahu Susu Pacaran',25000)" class="bg-white p-3 rounded shadow hover:bg-red-100 cursor-pointer">Tahu Pacaran - 25K</div>
      <div onclick="addToCart('Tahu Susu Jumbo',35000)" class="bg-white p-3 rounded shadow hover:bg-red-100 cursor-pointer">Tahu Jumbo - 35K</div>
      <div onclick="addToCart('Kentang Goreng',8000)" class="bg-white p-3 rounded shadow hover:bg-red-100 cursor-pointer">Kentang - 8K</div>
      <div onclick="addToCart('Sosis Jumbo Ori',8000)" class="bg-white p-3 rounded shadow hover:bg-red-100 cursor-pointer">Sosis Ori - 8K</div>
      <div onclick="addToCart('Sosis Jumbo Keju',10000)" class="bg-white p-3 rounded shadow hover:bg-red-100 cursor-pointer">Sosis Keju - 10K</div>
    </div>

    <div class="bg-white rounded p-4 shadow">
      <h2 class="text-lg font-bold mb-2">🛒 Keranjang</h2>
      <div id="cartList" class="mb-2"></div>
      <div class="font-bold text-right">Total: Rp <span id="totalHarga">0</span></div>

      <div class="mt-4">
        <label class="block text-sm font-semibold mb-1">💸 Uang Pembeli</label>
        <input type="text" id="uangPembeli" class="w-full border rounded p-2 mb-2" placeholder="Masukkan uang">
        <div class="text-right text-green-600 font-semibold">Kembalian: Rp <span id="kembalian">0</span></div>
      </div>

      <button onclick="simpanTransaksi()" class="mt-3 w-full bg-green-600 text-white py-2 rounded">Simpan Transaksi</button>
    </div>
  </section>

  <!-- REKAP -->
  <section id="rekap-tab" class="p-4 hidden-tab">
    <h1 class="text-2xl font-bold mb-4 text-red-600">📊 Rekap Hari Ini</h1>
    <div class="space-y-4" id="rekapList"></div>
    <button onclick="resetRekap()" class="mt-6 w-full bg-red-600 text-white py-2 rounded">Reset Rekap</button>
  </section>

  <script>
    let cart = {};

    function formatRupiah(n) {
      return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    function unformatRupiah(str) {
      return parseInt(str.replace(/\./g, '')) || 0;
    }

    function todayKey() {
      const t = new Date();
      return `rekap-${t.getFullYear()}-${t.getMonth() + 1}-${t.getDate()}`;
    }

    function addToCart(nama, harga) {
      if (!cart[nama]) cart[nama] = { qty: 1, harga };
      else cart[nama].qty += 1;
      renderCart();
    }

    function renderCart() {
      const cartList = document.getElementById("cartList");
      cartList.innerHTML = "";
      let total = 0;

      for (let nama in cart) {
        const item = cart[nama];
        const subtotal = item.qty * item.harga;
        total += subtotal;
        cartList.innerHTML += `
          <div class="flex justify-between mb-1 items-center">
            <div>${nama} <span class="text-sm text-gray-500">x ${item.qty}</span></div>
            <div>
              <button onclick="updateQty('${nama}', -1)" class="bg-red-500 text-white px-2 rounded">−</button>
              <button onclick="updateQty('${nama}', 1)" class="bg-green-500 text-white px-2 rounded">+</button>
            </div>
          </div>`;
      }

      document.getElementById("totalHarga").textContent = formatRupiah(total);
      const uang = unformatRupiah(document.getElementById("uangPembeli").value || "0");
      const kembalian = uang - total;
      document.getElementById("kembalian").textContent = formatRupiah(kembalian >= 0 ? kembalian : 0);
    }

    function updateQty(nama, delta) {
      cart[nama].qty += delta;
      if (cart[nama].qty <= 0) delete cart[nama];
      renderCart();
    }

    function simpanTransaksi() {
      let total = 0, itemCount = 0;
      const produk = [];

      for (let nama in cart) {
        const item = cart[nama];
        total += item.qty * item.harga;
        itemCount += item.qty;
        produk.push(`${nama} x ${item.qty}`);
      }

      const now = new Date();
      const tanggal = now.toLocaleDateString("id-ID");
      const jam = now.toLocaleTimeString("id-ID", { hour: '2-digit', minute: '2-digit' });

      const transaksi = {
        waktu: `${tanggal} ${jam}`,
        total,
        item: itemCount,
        produk
      };

      const key = todayKey();
      const data = JSON.parse(localStorage.getItem(key)) || [];
      data.push(transaksi);
      localStorage.setItem(key, JSON.stringify(data));

      cart = {};
      document.getElementById("uangPembeli").value = '';
      document.getElementById("kembalian").textContent = '0';
      renderCart();
      updateRekap();
      alert("✅ Transaksi disimpan!");
    }

    function updateRekap() {
      const key = todayKey();
      const data = JSON.parse(localStorage.getItem(key)) || [];
      const list = document.getElementById("rekapList");
      list.innerHTML = data.reverse().map((t, i) => `
        <div class="bg-white p-4 rounded shadow">
          <p class="text-sm text-gray-500">#${data.length - i} | ${t.waktu}</p>
          <p>🧾 Total: <strong>Rp ${formatRupiah(t.total)}</strong></p>
          <p>📦 Item: <strong>${t.item}</strong></p>
          <p class="mt-1 text-sm text-gray-700">🍽️ Makanan:</p>
          <ul class="list-disc ml-5 text-sm text-gray-700">
            ${t.produk.map(p => `<li>${p}</li>`).join('')}
          </ul>
        </div>
      `).join('');
    }

    function resetRekap() {
      if (confirm("Yakin ingin reset rekap hari ini?")) {
        localStorage.removeItem(todayKey());
        updateRekap();
      }
    }

    function showTab(tab) {
      ['home', 'rekap'].forEach(id => {
        document.getElementById(`${id}-tab`).classList.add('hidden-tab');
        document.getElementById(`tab-${id}`).classList.remove('active-tab');
      });
      document.getElementById(`${tab}-tab`).classList.remove('hidden-tab');
      document.getElementById(`tab-${tab}`).classList.add('active-tab');
    }

    document.getElementById("uangPembeli").addEventListener("input", function (e) {
      const val = e.target.value.replace(/\D/g, '');
      e.target.value = formatRupiah(val);
      renderCart();
    });

    updateRekap();
  </script>
</body>
</html>
